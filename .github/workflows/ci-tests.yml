name: CI Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'adopt'

      - name: Setup Nextflow latest-edge
        uses: nf-core/setup-nextflow@v1
        with:
          version: "latest-edge"

      - name: Install nf-test
        uses: nf-core/setup-nf-test@v1
        with:
          install-pdiff: true

      - name: Setup Micromamba
        uses: mamba-org/setup-micromamba@v2
        with:
          micromamba-version: 'latest' 
          init-shell: bash

      - name: create input and database stubs
        run: 
          mkdir -p subgraph_analyser/test_data
          touch subgraph_analyser/test_data/3002274_test.gfa
          touch subgraph_analyser/test_data/sample_1.fastq
          touch subgraph_analyser/test_data/sample_2.fastq
          mkdir -p subgraph_analyser/test_data/refseq_bacteria_kraken_db
          mkdir -p subgraph_analyser/test_data/bakta_light/db-light
          touch subgraph_analyser/test_data/card_protein_homolog_with_fam.fasta

      - name: Run Tests
        run: 
          cd subgraph_analyser &&nf-test test tests/stub.nf.test